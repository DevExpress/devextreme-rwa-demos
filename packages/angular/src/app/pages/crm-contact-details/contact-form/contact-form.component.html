<div id="contact-form">
  <dx-toolbar>
    <dxi-item location="before"><span class="form-title">Details</span></dxi-item>
    <dxi-item location="after" locateInMenu="after" [visible]="!isEditing">
      <dx-button
        text="Edit"
        icon="edit"
        stylingMode="outlined"
        type="default"
        (onClick)="toggleEdit()"
      ></dx-button>
    </dxi-item>
    <dxi-item location="after" locateInMenu="after" [visible]="isEditing">
      <dx-button
        text="Save"
        stylingMode="outlined"
        type="default"
        (onClick)="toggleEdit()"
      ></dx-button>
    </dxi-item>
    <dxi-item location="after" locateInMenu="after" [visible]="isEditing">
      <dx-button
        text="Cancel"
        (onClick)="toggleEdit()"
        stylingMode="text"
      ></dx-button>
    </dxi-item>
  </dx-toolbar>

  <div class="form-compact">
    <dx-form
      *ngIf="!isLoading"
      class="form last"
      [formData]="contactData$"
      labelMode="floating"
      [readOnly]="!isEditing"
    >
      <dxi-item itemType="group" [colCount]="2">
        <dxi-item dataField="image" template="photo"></dxi-item>
        <dxi-item itemType="group">
          <dxi-item
            dataField="status"
            template="statusField"
            [editorOptions]="editorOptions"
          >
          </dxi-item>
          <dxi-item
            dataField="firstName"
            template="itemPlain"
            [editorOptions]="editorOptions"
          ></dxi-item>
          <dxi-item
            dataField="lastName"
            template="itemPlain"
            [editorOptions]="editorOptions"
          ></dxi-item>
        </dxi-item>
        <dxi-item dataField="position"
                  template="itemPlain"
                  [editorOptions]="editorOptions"></dxi-item>
        <dxi-item  cssClass="accent"
                   dataField="manager"
                   template="itemPlain"
                   [editorOptions]="editorOptions"
        >
          <dxo-label text="Assigned to"></dxo-label>
        </dxi-item>
        <dxi-item cssClass="accent"
                  dataField="company"
                  template="itemPlain"
                  [editorOptions]="editorOptions"
                  [colSpan]="2"
        ></dxi-item>
      </dxi-item>

      <dxi-item itemType="group" [colCount]="4" caption="Contacts">
        <dxi-item
          dataField="address"
          template="itemPlain"
          [editorOptions]="editorOptions"
          [colSpan]="4"
        ></dxi-item>
        <dxi-item
          dataField="city"
          template="itemPlain"
          [editorOptions]="editorOptions"
          [colSpan]="2"
        ></dxi-item>
        <dxi-item template="state">
          <dxo-label text="State"></dxo-label>
        </dxi-item>
        <dxi-item dataField="zipCode" template="itemPlain" [editorOptions]="editorOptions"></dxi-item>
        <dxi-item dataField="phone" template="phone" [colSpan]="2"></dxi-item>
        <dxi-item dataField="email" template="email" [colSpan]="2"></dxi-item>
      </dxi-item>

      <!-- T1085831 -->
      <div *dxTemplate="let data of 'itemPlain'">
        <form-item-plain
          [isEditing]="isEditing"
          [label]="data.editorOptions.label"
          [(value)]="contactData$[data.dataField]"
        ></form-item-plain>
      </div>

      <div *dxTemplate="let data of 'state'">
        <form-item-plain
          [isEditing]="isEditing"
          [label]="data.editorOptions.label "
          [(value)]="contactData$.state.stateShort"
        ></form-item-plain>
      </div>

      <div *dxTemplate="let data of 'photo'">
        <form-item-photo
          [link]="data.editorOptions.value"
          [size]="184"
        ></form-item-photo>
      </div>

      <div *dxTemplate="let data of 'statusField'">
        <form-item-plain
          [isEditing]="isEditing"
          [label]="data.editorOptions.label"
          [value]="data.editorOptions.value"
          [valueTpl]="statusValueTpl"
          [editorTpl]="statusEditorTpl"
        ></form-item-plain>

        <ng-template #statusValueTpl>
          <contact-status [value]="data.editorOptions.value"></contact-status>
        </ng-template>

        <ng-template #statusEditorTpl>
          <dx-select-box
            [(value)]="contactData$.status"
            [items]="statusList"
            [stylingMode]="stylingMode"
            [label]="data.editorOptions.label"
            [readOnly]="!isEditing"
            fieldTemplate="field"
          >
            <div *dxTemplate="let data of 'field'">
              <div class="form-custom-list-prop">
                <contact-status [value]="contactData$.status"></contact-status>
                <dx-text-box [readOnly]="true"></dx-text-box>
              </div>
            </div>
            <div *dxTemplate="let data of 'item'">
              <contact-status [value]="data"></contact-status>
            </div>
          </dx-select-box>
        </ng-template>
      </div>

      <div *dxTemplate="let data of 'statusEditing'">
        <dx-select-box
          [(value)]="contactData$.status"
          [items]="statusList"
          [stylingMode]="stylingMode"
          [label]="data.editorOptions.label"
          [readOnly]="!isEditing"
          fieldTemplate="field"
        >
          <div *dxTemplate="let data of 'field'">
            <div class="form-custom-list-prop">
              <contact-status [value]="contactData$.status"></contact-status>
              <dx-text-box [readOnly]="true"></dx-text-box>
            </div>
          </div>
          <div *dxTemplate="let data of 'item'">
            <contact-status [value]="data"></contact-status>
          </div>
        </dx-select-box>
      </div>

      <div *dxTemplate="let data of 'phone'">
        <form-item-plain
          [isEditing]="isEditing"
          [label]="data.editorOptions.label"
          [value]="contactData$.phone"
          mask="+1(000)000-0000"
          [renderedValue]="contactData$.phone | phone"
        ></form-item-plain>
        <dx-button class="form-item-plain-button"
                   [visible]="!isEditing"
                   [text]="'Call'"
                   [icon]="'tel'"
                   [type]="'default'"
                   stylingMode="outlined"
        ></dx-button>
      </div>

      <div *dxTemplate="let data of 'email'">
        <form-item-plain
          [isEditing]="isEditing"
          [label]="data.editorOptions.label"
          [value]="contactData$.email"
        ></form-item-plain>
        <dx-button class="form-item-plain-button"
                   [visible]="!isEditing"
                   [text]="'Send Email'"
                   [icon]="'email'"
                   [type]="'default'"
                   stylingMode="outlined"
        ></dx-button>
      </div>
    </dx-form>
  </div>
  <dx-load-panel
    container="#contact-form"
    [position]="{ of: '#contact-form' }"
    [visible]="isLoading"
  ></dx-load-panel>
</div>
