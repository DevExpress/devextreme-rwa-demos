<div id="contact-form">
  <dx-toolbar>
    <dxi-item location="before"><span class="form-title">Details</span></dxi-item>
    <dxi-item location="after" locateInMenu="after" [visible]="!isEditing">
      <dx-button
        text="Edit"
        icon="edit"
        stylingMode="outlined"
        type="default"
        (onClick)="handleEditClick()"
      ></dx-button>
    </dxi-item>
    <dxi-item location="after" locateInMenu="after" [visible]="isEditing">
      <dx-button
        text="Save"
        stylingMode="outlined"
        type="default"
        (onClick)="handleSaveClick()"
      ></dx-button>
    </dxi-item>
    <dxi-item location="after" locateInMenu="after" [visible]="isEditing">
      <dx-button
        text="Cancel"
        (onClick)="handleCancelClick()"
        stylingMode="text"
      ></dx-button>
    </dxi-item>
  </dx-toolbar>

  <div class="custom-form">
    <dx-form #contactForm
      *ngIf="contactData"
      class="form last"
      [formData]="contactData"
      labelMode="floating"
      [class.view-mode]="!isEditing"
      [validationGroup]="validationGroup"
    >
      <dxi-item itemType="group" [colCount]="2">
        <dxo-col-count-by-screen [xs]="2"></dxo-col-count-by-screen>
        <dxi-item>
          <form-item-photo
            [link]="contactData.image"
            [size]="184"
          ></form-item-photo>
        </dxi-item>
        <dxi-item itemType="group">
          <dxi-item>
            <dx-select-box
              label="Status"
              [(value)]="contactData.status"
              [items]="statusList"
              [readOnly]="!isEditing"
              stylingMode="filled"
              width="100%"
              fieldTemplate="field"
            >
              <div *dxTemplate="let data of 'field'" class="form-item-custom">
                <contact-status [value]="contactData.status"></contact-status>
                <dx-text-box [readOnly]="true"></dx-text-box>
              </div>
              <div *dxTemplate="let data of 'item'">
                <contact-status [value]="data"></contact-status>
              </div>
            </dx-select-box>
          </dxi-item>

          <dxi-item>
            <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'First Name', value: contactData.firstName}}"></ng-container>
          </dxi-item>

          <dxi-item>
            <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Last Name', value: contactData.lastName}}"></ng-container>
          </dxi-item>
        </dxi-item>

        <dxi-item>
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Position', value: contactData.position}}"></ng-container>
        </dxi-item>

        <dxi-item cssClass="accent">
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Assigned to', value: contactData.manager}}"></ng-container>
        </dxi-item>

        <dxi-item cssClass="accent" [colSpan]="2">
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Company', value: contactData.company}}"></ng-container>
        </dxi-item>
      </dxi-item>

      <dxi-item itemType="group" [colCount]="4" caption="Contacts">
        <dxo-col-count-by-screen [xs]="2"></dxo-col-count-by-screen>
        <dxi-item [colSpan]="4">
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Address', value: contactData.address}}"></ng-container>
        </dxi-item>

        <dxi-item  [colSpan]="2" >
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'City', value: contactData.city}}"></ng-container>
        </dxi-item>

        <dxi-item>
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'State', value: contactData.state.stateShort}}"></ng-container>
        </dxi-item>

        <dxi-item>
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Zip Code', value: contactData.zipCode, validators: [zipCodeValidator]}}"></ng-container>
        </dxi-item>

      </dxi-item>

      <dxi-item itemType="group" [colCount]="2">
        <dxo-col-count-by-screen [xs]="2"></dxo-col-count-by-screen>
        <dxi-item>
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Phone', value: contactData.phone, mask: '+1(000)000-0000'}}"></ng-container>
          <dx-button class="form-item-button"
                     [visible]="!isEditing"
                     [text]="'Call'"
                     [icon]="'tel'"
                     [type]="'default'"
                     stylingMode="outlined"
          ></dx-button>
        </dxi-item>

        <dxi-item >
          <ng-container *ngTemplateOutlet="fieldTpl;
           context: {$implicit: {label: 'Email', value: contactData.email, validators: [{type: 'email'}]}}"></ng-container>
          <dx-button class="form-item-button"
                     [visible]="!isEditing"
                     [text]="'Send Email'"
                     [icon]="'email'"
                     [type]="'default'"
                     stylingMode="outlined"
          ></dx-button>
        </dxi-item>
      </dxi-item>

      <ng-template #fieldTpl let-data>
        <dx-text-box [label]="data.label"
                     [(value)]="data.value"
                     [readOnly]="!isEditing"
                     [mask]="data.mask"
                     [elementAttr]="{class: 'custom-field'}"
                     [inputAttr]="{class: 'custom-field-input'}"
                     stylingMode="filled"
                     valueChangeEvent="keyup input change"
        >
          <dx-validator [validationRules]="data.validators || [{type: 'required'}]" [validationGroup]="validationGroup"></dx-validator>
        </dx-text-box>
      </ng-template>

    </dx-form>
  </div>
  <dx-load-panel
    container="#contact-form"
    [position]="{ of: '#contact-form' }"
    [visible]="!contactData"
    [showPane]="false"
  ></dx-load-panel>
</div>
