<div class="view-wrapper">
  <dx-toolbar>
    <dxi-item
      location="before"
      widget="dxButton"
      [options]="{
        icon: 'arrowleft'
      }"
    ></dxi-item>
    <dxi-item
    location="before"
    >
      <span class="toolbar-header">{{ task.name }}</span>
    </dxi-item>

    <dxi-item
      location="after"
      locateInMenu="auto"
    >
      <dx-drop-down-button
        text="ACTIONS"
        stylingMode="contained"
        [ngClass]="'actions'"
        [items]="[
          { text: 'Duplicate' },
          { text: 'Close' },
          { text: 'Delete' }
        ]"
      ></dx-drop-down-button>
    </dxi-item>
    <dxi-item
      location="after"
      locateInMenu="auto"
    >
      <dx-button
        icon="attach"
      ></dx-button>
    </dxi-item>
    <dxi-item
      location="after"
      locateInMenu="auto"
    >
      <div class="separator"></div>
    </dxi-item>
  </dx-toolbar>

  <div class="panels">
    <div class="left">
      <dx-toolbar>
        <dxi-item location="before">
            <div class="panels-header">Details</div>
        </dxi-item>
        <dxi-item location="after" [visible]='!edit' locateInMenu="after" widget="dxButton"
            [options]="{text: 'Edit', icon: 'edit', stylingMode: 'outlined', type: 'default', onClick: toggleEdit}">
        </dxi-item>
        <dxi-item location="after" [visible]='edit' locateInMenu="after" widget="dxButton"
            [options]="{text: 'Save', stylingMode: 'outlined', type: 'default', onClick: toggleEdit}">
        </dxi-item>
        <dxi-item location="after" [visible]='edit' locateInMenu="after" widget="dxButton"
            [options]="{text: 'Cancel', onClick: toggleEdit}">
        </dxi-item>
      </dx-toolbar>

      <ng-template [ngIf]="!edit" [ngIfElse]="editingForm">
        <div class="info">
          <div>
              <div class="title">Company</div>
              <div class="value">{{ task.name }}</div>
          </div>
          <div>
              <div class="title">Assigned to</div>
              <div class="value">{{ task.owner }}</div>
          </div>
        </div>
        <div class="info">
          <div>
              <div class="title">Priority</div>
              <div class="value">
                <task-priority [value]="task.priority"></task-priority>
              </div>
          </div>
          <div>
              <div class="title">Status</div>
              <div class="value">
                <task-status [value]="task.status"></task-status>
              </div>
          </div>
        </div>
        <div class="info">
          <div>
              <div class="title">Start Date</div>
              <ng-template [ngIf]="!isEmptyStartDate">
                <div class="value black">{{ parseDate(task.startDate) }}</div>
              </ng-template>
              <dx-drop-down-button
                  icon="event"
                  text="START DATE"
                  stylingMode="outlined"
                  [showArrowIcon]="false"
                  [selectionMode]="false"
                  [visible]="isEmptyStartDate"
              ></dx-drop-down-button>
          </div>
          <div>
              <div class="title">Due Date</div>
              <ng-template [ngIf]="!isEmptyDueDate">
                <div class="value black">{{ parseDate(task.dueDate) }}</div>
              </ng-template>
              <dx-drop-down-button
                icon="event"
                text="DUE DATE"
                stylingMode="outlined"
                [showArrowIcon]="false"
                [visible]="isEmptyDueDate"
              ></dx-drop-down-button>
          </div>
        </div>
        <div class="info last long">
          <div>
              <div class="title">Details</div>
              <div class="value black">{{ task.description }}</div>
          </div>
        </div>
      </ng-template>
      <ng-template #editingForm>
        <dx-form
          [colCount]="2"
          [formData]="task"
          labelMode="floating"
        >
          <dxi-item
            [colSpan]="2"
            dataField="name"
          ></dxi-item>
          <dxi-item
            dataField="company"
          ></dxi-item>
          <dxi-item
            dataField="owner"
          >
            <dxo-label
              text="Assigned to"
            ></dxo-label>
          </dxi-item>
          <dxi-item
            dataField="priority"
            editorType="dxSelectBox"
            [editorOptions]="{ items: priorityList }"
          ></dxi-item>
          <dxi-item
            dataField="status"
            editorType="dxSelectBox"
            [editorOptions]="{ items: statusList }"
          ></dxi-item>
          <dxi-item
            dataField="startDate"
            editorType="dxDateBox"
            [editorOptions]="{ onValueChanged: changeDate, name: 'Start Date' }"
          ></dxi-item>
          <dxi-item
            dataField="dueDate"
            editorType="dxDateBox"
            [editorOptions]="{ onValueChanged: changeDate, name: 'Due Date' }"
          ></dxi-item>
          <dxi-item
            [colSpan]="2"
            dataField="description"
            editorType="dxTextArea"
          >
            <dxo-label
              text="Details"
            ></dxo-label>
          </dxi-item>
        </dx-form>
      </ng-template>
    </div>
    <div class="right">
      <div class="dx-card">
        <dx-tab-panel [showNavButtons]="true">
            <dxi-item title="Activities">
                <div class="tab-content">
                    <app-activities [activities]="activities" [showBy]="true"></app-activities>
                </div>
            </dxi-item>
            <dxi-item title="Notes">
              <app-notes [items]="notes"></app-notes>
            </dxi-item>
            <dxi-item title="Messages" [badge]="(messages | async)?.length">
              <app-messages [userName]="task.owner" [items]="messages"></app-messages>
            </dxi-item>
        </dx-tab-panel>
    </div>
    </div>
  </div>
</div>
