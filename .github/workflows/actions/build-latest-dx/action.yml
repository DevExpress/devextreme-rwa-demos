name: "Show Directory and Greet"
description: "Display current directory and greet"

runs:
  using: 'composite'
  steps:
    - shell: bash

    #Build Devextreme latest
    - name: Checkout Devextreme
      run: git clone https://github.com/DevExpress/DevExtreme.git devextreme

    - name: Use Node.js 18
      uses: actions/setup-node@v3
      with:
        node-version: '18.16.1'

    - name: Set NPM version
      run: npm i npm@8 -g

    - name: DevExtreme - Restore npm cache
      uses: actions/cache@v3
      with:
        path: 'devextreme/**/node_modules'
        key: ${{ runner.os }}-node-modules-${{ hashFiles('devextreme/**/package-lock.json') }}

    - name: DevExtreme - Install packages
      working-directory: devextreme
      run: npm install --no-audit --no-fund

    - name: DevExtreme - Build
      working-directory: devextreme/packages/devextreme
      run: npm run build-npm-devextreme

    - name: DevExtreme - Pack
      working-directory: devextreme/packages/devextreme/artifacts/npm/devextreme
      run: npm pack

    - name: DevExtreme dist - Pack
      working-directory: devextreme/packages/devextreme/artifacts/npm/devextreme-dist
      run: npm pack

    - name: Upload devextreme Artifact
      uses: actions/upload-artifact@v3
      with:
        retention-days: 1
        name: devextreme-npm
        path: |
          devextreme/packages/devextreme/artifacts/npm/devextreme/devextreme-*.tgz
          devextreme/packages/devextreme/artifacts/npm/devextreme-dist/devextreme-dist*.tgz
    - name: DevExtreme-angular - Build
      working-directory: devextreme/packages/devextreme-angular
      run: npm run build

    - name: DevExtreme-angular - Pack
      working-directory: devextreme/packages/devextreme-angular
      run: npm run pack

    - name: Upload devextreme-angular Artifact
      uses: actions/upload-artifact@v2
      with:
        retention-days: 1
        name: devextreme-angular-npm
        path: devextreme/packages/devextreme-angular/npm/dist/devextreme-angular*.tgz

    - name: DevExtreme-react - Pack
      working-directory: devextreme/packages/devextreme-react
      run: npm run pack

    - name: DevExtreme-react - Pack npm
      working-directory: devextreme/packages/devextreme-react/npm
      run: npm pack

    - name: Upload devextreme-react Artifact
      uses: actions/upload-artifact@v2
      with:
        retention-days: 1
        name: devextreme-react-npm
        path: devextreme/packages/devextreme-react/npm/devextreme-react*.tgz

    - name: DevExtreme-vue - Pack
      working-directory: devextreme/packages/devextreme-vue
      run: npm run pack

    - name: DevExtreme-vue - Pack npm
      working-directory: devextreme/packages/devextreme-vue/npm
      run: npm pack

    - name: Upload devextreme-vue Artifact
      uses: actions/upload-artifact@v2
      with:
        retention-days: 1
        name: devextreme-vue-npm
        path: devextreme/packages/devextreme-vue/npm/devextreme-vue*.tgz

